<!DOCTYPE html>
<html width="100%" height="100%" lang="en">
<head>
	<!-- Google Analytics Content Experiment code -->
	<script>function utmx_section(){}function utmx(){}(function(){var
			k='117546629-6',d=document,l=d.location,c=d.cookie;
		if(l.search.indexOf('utm_expid='+k)>0)return;
		function f(n){if(c){var i=c.indexOf(n+'=');if(i>-1){var j=c.
		indexOf(';',i);return escape(c.substring(i+n.length+1,j<0?c.
				length:j))}}}var x=f('__utmx'),xx=f('__utmxx'),h=l.hash;d.write(
				'<sc'+'ript src="'+'http'+(l.protocol=='https:'?'s://ssl':
						'://www')+'.google-analytics.com/ga_exp.js?'+'utmxkey='+k+
				'&utmx='+(x?x:'')+'&utmxx='+(xx?xx:'')+'&utmxtime='+new Date().
				valueOf()+(h?'&utmxhash='+escape(h.substr(1)):'')+
				'" type="text/javascript" charset="utf-8"><\/sc'+'ript>')})();
	</script><script>utmx('url','A/B');</script>
	<!-- End of Google Analytics Content Experiment code -->

    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="js/jquery-1.12.0.min.js"></script>
	<script src="js/accordion.js" type="text/javascript"></script>
	<script src="js/bootstrap.min.js" type="text/javascript"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.min.js"></script>
	<!--<script src="js/compare.js" type="text/javascript"></script>-->

	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/compare.css">
	<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Josefin+Sans" />
	<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Amaranth" />
	<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

	<link rel="shortcut icon" href="img/snooZzzvs.png?r=2423">
	<link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet">
	<meta charset="UTF-8">
	<title>Compare</title>
</head>
<body width="100%" height="100%">

	<nav class="navbar navbar-inverse">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="./index"><span style="color: lightblue">SnooZzz </span><span style="color: gold">VS</span></a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav navbar-right">
					<li><a href="./index">Home</a></li>
					<li><a href="./account">Account</a></li>
					<li><a href="./help">Help</a></li>
					<li><a href="./login">Logout</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="page-header" align="center">
	  <h1>Compare with others!</h1>
	</div>

	<div class="container" align="center">
		<p>View sleep cycles of other users</p>
	</div>

	<h4 align="center"><i id="infoIcon" class='glyphicon glyphicon-question-sign' style="color: #428bca;"></i>
		Filter others' data by:
	</h4>
	<br>

	<div class="container" align="center">
    <table>
        <tbody>
			<tr>
				<td class="mytds" style="text-align: center">Ideal Sleep Time</td>
				<td id="avgSleepTime" class="avgTimes">
					<div class="btn-group-wrap">
						<div class="btn-toolbar" role="toolbar" aria-label="...">
							<div class="chart-toggles btn-group">
								<select id="avgSleepHourSelect" class="hB enabled btn btn-default">
									<option>&nbsp;</option>
									<option>1</option>
									<option>2</option>
									<option>3</option>
									<option>4</option>
									<option>5</option>
									<option>6</option>
									<option>7</option>
									<option>8</option>
									<option>9</option>
									<option>10</option>
									<option>11</option>
									<option>12</option>
								</select>
								<select id="avgSleepMinuteSelect" class="sB enabled btn btn-default">
									<option>&nbsp;</option>
									<option>00</option><option>01</option><option>02</option><option>03</option>
									<option>04</option><option>05</option><option>06</option><option>07</option>
									<option>08</option><option>09</option><option>10</option><option>11</option>
									<option>12</option><option>13</option><option>14</option><option>15</option>
									<option>16</option><option>17</option><option>18</option><option>19</option>
									<option>20</option><option>21</option><option>22</option><option>23</option>
									<option>24</option><option>25</option><option>26</option><option>27</option>
									<option>28</option><option>29</option><option>30</option><option>31</option>
									<option>32</option><option>33</option><option>34</option><option>35</option>
									<option>36</option><option>37</option><option>38</option><option>39</option>
									<option>40</option><option>41</option><option>42</option><option>43</option>
									<option>44</option><option>45</option><option>46</option><option>47</option>
									<option>48</option><option>49</option><option>50</option><option>51</option>
									<option>52</option><option>53</option><option>54</option><option>55</option>
									<option>56</option><option>57</option><option>58</option><option>59</option>
								</select>
								<select id="avgSleepMeridiemSelect" class="aB enabled btn btn-default">
									<option>&nbsp;</option>
									<option>AM</option>
									<option>PM</option>
								</select>
							</div>
						</div>
					</div>
				</td>
			</tr>
			<tr>
				<td class="mytds" style="text-align: center">Ideal Wake Time</td>
				<td id="avgWakeTime" class="avgTimes">
					<div class="btn-group-wrap">
						<div class="btn-toolbar" role="toolbar" aria-label="...">
							<div id="avgWakeTimeDiv" class="chart-toggles btn-group">
								<select id="avgWakeHourSelect" class="hB enabled btn btn-default">
									<option>&nbsp;</option>
									<option>1</option>
									<option>2</option>
									<option>3</option>
									<option>4</option>
									<option>5</option>
									<option>6</option>
									<option>7</option>
									<option>8</option>
									<option>9</option>
									<option>10</option>
									<option>11</option>
									<option>12</option>
								</select>
								<select id="avgWakeMinuteSelect" class="sB enabled btn btn-default">
									<option>&nbsp;</option>
									<option>00</option><option>01</option><option>02</option><option>03</option>
									<option>04</option><option>05</option><option>06</option><option>07</option>
									<option>08</option><option>09</option><option>10</option><option>11</option>
									<option>12</option><option>13</option><option>14</option><option>15</option>
									<option>16</option><option>17</option><option>18</option><option>19</option>
									<option>20</option><option>21</option><option>22</option><option>23</option>
									<option>24</option><option>25</option><option>26</option><option>27</option>
									<option>28</option><option>29</option><option>30</option><option>31</option>
									<option>32</option><option>33</option><option>34</option><option>35</option>
									<option>36</option><option>37</option><option>38</option><option>39</option>
									<option>40</option><option>41</option><option>42</option><option>43</option>
									<option>44</option><option>45</option><option>46</option><option>47</option>
									<option>48</option><option>49</option><option>50</option><option>51</option>
									<option>52</option><option>53</option><option>54</option><option>55</option>
									<option>56</option><option>57</option><option>58</option><option>59</option>
								</select>
								<select id="avgWakeMeridiemSelect" class="aB enabled btn btn-default">
									<option>&nbsp;</option>
									<option>AM</option>
									<option>PM</option>
								</select>
							</div>
						</div>
					</div>
				</td>
			</tr>
            <tr>
				<td class="mytds" style="text-align: center">Ideal Mood</td>
				<td id="avgHappiness">
					<div class="btn-group-wrap">
						<div class="btn-toolbar" role="toolbar" aria-label="...">
							<div class="chart-toggles btn-group">
								<select id="avgHappinessSelect" class="hB enabled btn btn-default">
									<option>&nbsp;</option>
									<option>1</option>
									<option>2</option>
									<option>3</option>
									<option>4</option>
									<option>5</option>
									<option>6</option>
									<option>7</option>
								</select>
							</div>
						</div>
					</div>
				</td>
            </tr>
        </tbody>
    </table>
	</div>
	<br>
	<div class="container" align="center">
		<button id="compareButton" class="btn btn-primary" data-toggle="button" data-toggle="tooltip">Compare!
		</button>
	</div>
	<br>

    <div class="container" id="dataResults">
    	<table id="compareTable" class="table">
    		<thead>
    			<th class="myths">Anonymous User</th>
    			<th class="myths">Sleep</th>
    			<th class="myths">Wake</th>
    			<th class="myths">Mood</th>
    		</thead>
    		<tbody id="mytbody">
				<!-- Filled in by javascript -->
    		</tbody>
    	</table>
    </div>
	<br>

	<style>
		.mytds {
			width: 30%;
		}

		.myths {
			text-align: center;
			background-color: lightgrey;
		}

		#mytbody {
			text-align: center;
		}
	</style>

	<script>
		// get the session info
		/*var compareVisited;
		$.ajax({
			type: 'GET',
			url: '/user',
			async: false,
			success: function(req) {
				compareVisited = req.session.compareVisited;
			}
		});*/

		var boolWakeFilter = 0;
		var boolSleepFilter = 0;
		var boolHappinessFilter = 0;

		// for displaying the "i" icon bubble text
		$(document).ready(function() {
		    $('#infoIcon').attr("data-original-title", "Click me!");
		    $('#infoIcon').tooltip('show');

		    $('#infoIcon').click(function() {
		        $('#infoIcon').tooltip('toggle');
		        $('#infoIcon').attr("data-original-title", "Toggle between the buttons and see the mood level for each category that corresponds to the color on the graph");
		        $('#infoIcon').tooltip('show');
		    });
		});
		$('#infoIcon').tooltip();

		function requireFieldInputs(arg2, arg3) {
			var boolarg2 = 0;
			var boolarg3 = 0;

			if($(arg2).val() === "") {
//				$(arg2).css("box-shadow", "1px 1px 5px red");
				boolarg2 = 0;
			} else {
//				$(arg2).css("box-shadow", "");
				boolarg2 = 1;
			}

			if($(arg3).val() === "") {
//				$(arg3).css("box-shadow", "1px 1px 5px red");
				boolarg3 = 0;
			} else {
//				$(arg3).css("box-shadow", "");
				boolarg3 = 1;
			}

			if(boolarg2 && boolarg3) {
				if($(arg2).attr("id").indexOf("Wake") > 0) {
					boolWakeFilter = 1;
				} else {
					boolSleepFilter = 1;
				}
			} else {
				if($(arg2).attr("id").indexOf("Wake") > 0) {
					boolWakeFilter = 0;
				} else {
					boolSleepFilter = 0;
				}
			}
		}

		function fillFieldInputs(arg1, arg2, arg3) {
			var key = $(arg1).attr("id");
			if($(arg1).val() === "" && $(arg2).val() === "" && $(arg3).val() === "") {
				$(arg1).css("box-shadow", "");
				$(arg2).css("box-shadow", "");
				$(arg3).css("box-shadow", "");
				if(key.indexOf("Wake") > 0) {
					boolWakeFilter = 0;
				} else {
					boolSleepFilter = 0;
				}
			} else {
				$(arg1).css("box-shadow", "");
				$(arg1).change(requireFieldInputs(arg2, arg3));
			}
		}

		// THE IDEA:
		// get closest 'select' id to click event
		// pass the other two 'select' id's as arg2 and arg3
		$(".avgTimes").click(function(e) {
			var parent = $(e.target).closest("select").parent();
			var parentArray = parent.children(); //length 3

			var arg1 = $(e.target).closest("select");//.attr("id");
			var arg2;
			var arg3;
			for(var i = 0; i < parentArray.length; ++i) {
				if(arg1.attr("id") === parentArray[i].id) {
//					alert("finally");
				} else {
					if(arg2 === undefined) {
						arg2 = parentArray[i];
					} else {
						arg3 = parentArray[i];
					}
				}
			}
			// verify that the arguments are set correctly
			// console.log(arg1.attr("id") +"\n" + arg2.id+"\n" + arg3.id);
			fillFieldInputs(arg1, arg2, arg3);
		});

		// for monitoring the "happinessFilter"
		$("#avgHappinessSelect").change(function() {
			if($(this).val() === "") {
				boolHappinessFilter = 0;
			} else {
				boolHappinessFilter = 1;
			}
		});

		// script to auto generate random data for the compare table
		function generateRandomTableData() {
			// Clear the compare table
			$("#mytbody").html("");

			// Populate the compare table
			for(var i = 0; i < 10; ++i) {

				//ANONYMOUS USERS
				var user = i+1;
				// user = Math.random();

				// AVERAGE SLEEP
				var sleepHour, sleepMinute, sleepMeridiem;
				if(boolSleepFilter) {
					sleepHour = $("#avgSleepHourSelect").val();
					sleepMinute = $("#avgSleepMinuteSelect").val();
					sleepMeridiem = $("#avgSleepMeridiemSelect").val();
				} else {
					if(boolWakeFilter) {
						// # based on Average Wake Time
						var timeAwoken = Math.floor(Math.random() * (8 - 2 + 1)) + 2;
						var wakeHour = $("#avgWakeHourSelect").val();
						sleepHour = (parseInt(wakeHour) + parseInt(timeAwoken))%12;
						sleepHour = (sleepHour === 0) ? 12 : sleepHour;
						var hoursOfSleep = (12 - parseInt(sleepHour)) + parseInt(wakeHour);
						if(hoursOfSleep > 12) {
							sleepMeridiem = "AM";
						} else {
							sleepMeridiem = "PM";
						}
					} else {
						// # from 1 through 12
						sleepHour = Math.floor((Math.random() * 12) + 1);
						sleepMeridiem = "PM";
					}
					// # from 0 through 59
					sleepMinute = Math.floor(Math.random() * 59);
					sleepMinute = (sleepMinute.toString().length === 1) ? "0"+sleepMinute : sleepMinute;
				}
				var sleepTime = sleepHour+":"+sleepMinute+" "+sleepMeridiem;


				// AVERAGE WAKE
				var wakeHour, wakeMinute, wakeMeridiem;
				if(boolWakeFilter) {
					wakeHour = $("#avgWakeHourSelect").val();
					wakeMinute = $("#avgWakeMinuteSelect").val();
					wakeMeridiem = $("#avgWakeMeridiemSelect").val();
				} else {
					// # from 1 through 12
					var timeSlept = Math.floor(Math.random() * (10 - 4 + 1)) + 4;
					wakeHour = (parseInt(sleepHour) + parseInt(timeSlept))%12;
					wakeHour = (wakeHour === 0) ? 12 : wakeHour;

					// # from 0 through 59
					wakeMinute = Math.floor(Math.random() * 59);
					wakeMinute = (wakeMinute.toString().length === 1) ? "0"+wakeMinute : wakeMinute;

					var hoursOfSleep = (12 - parseInt(sleepHour)) + parseInt(wakeHour);
					if(hoursOfSleep > 12 && wakeHour !== 12) {
						wakeMeridiem = "PM";
					} else {
						wakeMeridiem = "AM";
					}
				}
				var wakeTime = wakeHour+":"+wakeMinute+" "+wakeMeridiem;


				// AVERAGE HAPPINESS
				var happiness;
				if(boolHappinessFilter) {
					// # from 1 through 7
					 happiness = $("#avgHappinessSelect").val();
				} else {
					var hoursOfSleep = parseInt((12 - parseInt(sleepHour)) + parseInt(wakeHour)) % 12;
					if(hoursOfSleep > 8) {
						happiness = Math.floor(Math.random() * (6 - 4 + 1)) + 4;
					} else if(hoursOfSleep > 5) {
						happiness = Math.floor(Math.random() * (7 - 5 + 1)) + 5;
					} else {
						happiness = Math.floor(Math.random() * (5 - 1 + 1)) + 1;
					}
				}

				// HTML TO APPEND
				var tableDataStructure =
						"<tr>" +
							"<td>"+"Anon User " + user +"</td>" +
							"<td>"+sleepTime+"</td>" +
							"<td>"+wakeTime+"</td>" +
							"<td>"+happiness+"</td>" +
						"</tr>";
				$("#mytbody").append(tableDataStructure);
			}
		}

		// Google Analytic Counters
		var gaCounter = 0;

		// for displaying the compare table
		$("#compareButton").click(function() {
			// to DEBUG row filters
			//console.log("boolSleepFilter = " + boolSleepFilter + "\n" +
			//		"boolWakeFilter = " + boolWakeFilter + "\n" +
			//		"boolHappinessFilter = " + boolHappinessFilter + "\n");


			ga("send", "event", "compareClick", "click", "compareClicked");

			if(!boolSleepFilter && !boolWakeFilter && !boolHappinessFilter) {
				if(gaCounter === 0) {
					++gaCounter;
					ga("send", "event", "compareClickFailure", "click", "compareFailure");
				}
				$(this).attr("data-original-title", "Make sure that at least 1 row of filters is completely filled out in order to Compare.");
				$(this).tooltip('show');
			} else if(boolSleepFilter && boolWakeFilter && boolHappinessFilter) {
				if(gaCounter === 0) {
					++gaCounter;
					ga("send", "event", "compareClickFailure", "click", "compareFailure");
				}
				$(this).attr("data-original-title", "Make sure that at most 2 rows of filters are applied. 1 row should be left blank.");
				$(this).tooltip('show');
			} else {
				if(gaCounter === 0) {
					++gaCounter;
					ga("send", "event", "compareClickSuccess", "click", "compareSuccess");
				}

				generateRandomTableData();

				// for displaying the table and hiding tooltip
				$("#compareButton").tooltip('hide');
				$("#compareTable").show("medium");
			}
		});

		// GOOGLE  ANALYTICS ID
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
					(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-73881570-2', 'auto');
		ga('send', 'pageview');
	</script>
</body>
</html>